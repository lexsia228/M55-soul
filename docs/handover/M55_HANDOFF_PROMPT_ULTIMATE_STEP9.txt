# M55 Project: Phase 2 Implementation Protocol (Step10)
# Timestamp: 2026-01-27 | Mode: PRO / ARCHITECT
# Status: SSOT FROZEN. PHYSICAL IMPLEMENTATION START.

==================================================
1. IDENTITY & MISSION
==================================================
- Role: M55 SSOT Executor (Architect-grade, non-proposal).
- Objective: Ship v1.0 as a flawless, non-invasive sanctuary UI (JP market 2026).
- Immediate Task: Step10 - Finalize "6 Matrix HTML Templates"
  (PAGE_TAROT / PAGE_AI_CHAT / PAGE_MYPAGE / PAGE_TODAY / PAGE_AI_CALENDAR / PAGE_DTR_SHELF)
  with full SSOT compliance + v1.0 hidden + Dead End 0.

NOTE:
- Step9 (TZ→period_key→expires_at→唯一ルート配線) は既に凍結済み。ここでは壊さない。

==================================================
2. UPLOADED SSOT ASSETS (Constitution)
==================================================
- Uploaded docs/files are the Constitution.
- DO NOT invent new systems or rename frozen entities.
- If any file is missing in this new thread, request user to re-upload or paste it (no guessing).

==================================================
3. ABSOLUTE RULES (Non-negotiable)
==================================================
- Background SSOT侵食ゼロ:
  No changes to global background / html,body background / global tone.
  Background single source of truth: M55_PHASE1_METER_FREEZE_v2_2_RELEASE_CANDIDATE
- Structure Freeze:
  Existing DOM/class/id/order/tap-areas MUST NOT change.
  Allowed: text replacement, CSS visual refinements, minimal JS for state/display only.
- v1.0: Unimplemented = hidden (display:none/hidden/feature flag). Never delete.
- Dead End 0:
  Must return to HOME within 2 taps from any visible screen.
  Never create "parentless page" or "modal loop" (close/back must remain).
- Safety RED:
  Physically skip LLM and return fixed safe template. Never send to LLM.
- No ranking / no numeric ordering semantics on DTR shelf (shelf presence only).

==================================================
4. MASTER BINDING & TAP INVENTORY (Injected SSOT / Single Source)
==================================================
This inventory is the ONLY allowed map for taps + bindings.
(If conflicts with uploaded SSOT, uploaded SSOT wins.)

[Tap Map + Data Binding Map]
```json
{
  "project": "M55",
  "guard": {
    "dead_end_0": "Must return to HOME in 2 taps",
    "v1_hidden": "Unimplemented blocks/routes must be hidden (not removed)",
    "structure_freeze": "DOM/class/id/order/tap-area must not change",
    "background_freeze": "No global background/tone changes"
  },
  "inventory_binding_matrix": {
    "PAGE_HOME": {
      "taps": {
        "bottom_tab.home": "PAGE_HOME",
        "bottom_tab.tarot": "PAGE_TAROT",
        "bottom_tab.chat": "PAGE_AI_CHAT",
        "bottom_tab.dtr": "PAGE_DTR_SHELF",
        "bottom_tab.mypage": "PAGE_MYPAGE",

        "hero_meter": "PAGE_AI_METER_DETAIL",
        "daily_card": "PAGE_TODAY",
        "calendar_btn": "PAGE_AI_CALENDAR"
      },
      "bindings": {
        "#weekly_meter_fill": "m55_meter_cache(type=weekly, period_key=current_iso_week).scores.weekly_fill",
        "#three_dot_status": "m55_meter_cache(type=weekly, period_key=current_iso_week).scores.three_dot_status",

        "#angel_text_main": "heart_log(latest_of_today, type=mini_read, subtype=angel_moment).full_text",
        "#angel_text_short": "heart_log(latest_of_today, type=mini_read, subtype=angel_moment).short_text"
      }
    },

    "PAGE_TAROT": {
      "taps": { "back": "PAGE_HOME", "draw_one": "EXEC_DRAW_ONE" },
      "bindings": { "#tarot_result": "heart_log(latest, type=tarot).payload" }
    },

    "PAGE_AI_CHAT": {
      "taps": { "back": "PAGE_HOME", "send": "EXEC_SEND_CHAT" },
      "bindings": { "#chat_thread": "chat_store(thread_id=current)" }
    },

    "PAGE_MYPAGE": {
      "taps": { "back": "PAGE_HOME" },
      "bindings": {
        "#profile_timezone": "user_profile.settings.timezone",
        "#angel_history_list": "heart_log(list, type=mini_read, subtype=angel_moment)"
      }
    },

    "PAGE_TODAY": {
      "taps": { "back": "PAGE_HOME" },
      "bindings": { "#today_insight": "heart_log(latest_of_today, type=mini_read, subtype=angel_moment).full_text" }
    },

    "PAGE_AI_CALENDAR": {
      "taps": { "close": "PAGE_HOME" },
      "bindings": { ".cell_short_text": "heart_log(type=mini_read).short_text" }
    },

    "PAGE_DTR_SHELF": {
      "taps": {
        "back": "PAGE_HOME",
        "shelf_card": "EXEC_OPEN_DTR_IF_IMPLEMENTED_ELSE_HIDDEN"
      },
      "bindings": {
        ".shelf_items": "m55_content_cache(key=dtr_shelf_v1).items"
      },
      "v1_rules": {
        "genre_tabs": "HIDDEN",
        "rank_numbers": "FORBIDDEN"
      }
    }
  }
}
